
<% if user_signed_in? %>
  <% account_type = current_user.account_type %>

  <h4 style='text-align: center;'> Drivers in <%= @state %> </h4>
  <div style='margin: 0 auto; width: fit-content;'>
    <div id="map" style='width: 800px; height: 400px;'></div>
  </div>

  <script type="text/javascript">
    handler = Gmaps.build(
      'Google',
      {
        markers: {
          maxRandomDistance: 100,
          clusterer: { maxZoom: 12, gridSize: 40 }
        }
      }
    );
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  </script>



  <h1>Driver Feed</h1>
  <%= link_to 'New Driver', new_driver_path %>
  <%= link_to 'home', drivers_path %>


  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Current Location</th>
        <th>Desired City</th>
        <th>Desired State</th>
        <th>Desired Zip</th>
        <th>Driver ID</th>
        <th>Phone</th>
        <th>Truck Type</th>
        <th>Active</th>
        <th>Driver status</th>
        <th>Contract Number</th>
        <th>Availability</th>
        <th>Company</th>
        <th>Comments</th>
        <th>Covered</th>
        <th>Plate Trailer</th>
        <th>Etrac</th>
        <th>Preferred Lanes</th>
        <th>Reefer Unit</th>
        <th>Insurance</th>
        <th colspan="12"></th>
      </tr>
    </thead>

    <tbody>
      <% @drivers.each do |driver,user| %>
        <tr>
          <td><%= driver.full_name %></td>
          <td><%= driver.full_address %></td>
          <td><%= driver.desired_city %></td>
          <td><%= driver.desired_state %></td>
          <td><%= driver.desired_zip %></td>
          <td><%= driver.driver_id_tag %></td>
          <td><%= driver.driver_phone %></td>
          <td><%= driver.driver_truck_type %></td>
            <% if driver.active == true%>
          <td class="success"><%= humanize_boolean(driver.active?)%></td>
          <% else %>
          <td class="danger"><%= humanize_boolean(driver.active?) %></td>
            <% end %>
          <td><%= driver.driver_status %></td>
          <td><%= driver.driver_contract_number %></td>
          <td><%= driver.driver_availability %></td>
          <td><%= driver.driver_company %></td>
          <td><%= driver.comments %></td>
          <% if driver.Covered == true%>

          <td class="success"><%= driver.user %></td>
          <% else %>
          <td class="danger"><%= humanize_boolean(driver.Covered?) %></td>
         <% end %>

          <td><%= driver.PlateTrailer %></td>
          <td><%= driver.Etrac %></td>
          <td><%= driver.PreferredLanes %></td>
          <td><%= driver.reeferunit %></td>
          <td><%= driver.insurance %></td>
          <% if account_type == 'admin' || account_type == 'updater' %>

            <td>
              <%= link_to 'Show', driver %>
            </td>

            <td>
              <%= link_to 'Edit', edit_driver_path(driver) %>
            </td>

            <td>
              <%= link_to 'Destroy',
                driver,
                method: :delete,
                data: { confirm: 'Are you sure?' } %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br>

<% else %>

  <div class="container main-pg">
    <div class="row">
      <div class="col-md-4"></div>
      <div class="col-md-4">
        <section class="login-form">
          <%= form_for(:user, :url => session_path(:user)) do |f| %>
            <%= f.text_field :email, placeholder: "E-Mail Address" %>
            <%= f.password_field :password, placeholder: "Password"  %> </br>
            <%= f.check_box :remember_me %>
            <%= f.label :remember_me %>
            <%= f.submit 'Sign in' , :class => "btn btn-md btn-primary btn-block"  %>
            <%= link_to "Forgot your password?", new_password_path(:user) %>
          <% end %>
        </section>
      </div>
    </div>
  </div>
<% end %>


